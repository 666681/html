<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>艾瑟兰大陆冒险</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚔️</text></svg>">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(to bottom, #1a1a2e, #16213e);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .game-header {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .game-header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(52, 152, 219, 0.1) 0%, transparent 70%);
            z-index: -1;
        }
        
        .game-title {
            color: var(--light);
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 0 10px var(--secondary);
            animation: glow 3s infinite alternate;
        }
        
        @keyframes glow {
            0% { text-shadow: 0 0 5px var(--secondary); }
            100% { text-shadow: 0 0 20px var(--secondary), 0 0 30px var(--accent); }
        }
        
        .game-subtitle {
            color: var(--light);
            font-size: 1.2rem;
            opacity: 0.8;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
            background: rgba(30, 40, 60, 0.7);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            position: relative;
        }
        
        .status-bar::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, transparent 0%, rgba(52, 152, 219, 0.1) 100%);
            z-index: -1;
            pointer-events: none;
        }
        
        .status-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 80px;
        }
        
        .status-label {
            font-size: 0.9rem;
            color: #bbbbbb;
            margin-bottom: 5px;
        }
        
        .status-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: white;
        }
        
        .game-area {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .player-panel {
            flex: 1;
            min-width: 300px;
            background: rgba(30, 40, 60, 0.8);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            color: var(--light);
            position: relative;
            overflow: hidden;
        }
        
        .player-panel::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 70% 20%, rgba(231, 76, 60, 0.1) 0%, transparent 30%);
            z-index: -1;
            pointer-events: none;
        }
        
        .game-content {
            flex: 3;
            min-width: 300px;
            background: rgba(20, 30, 40, 0.8);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
            color: var(--light);
        }
        
        .panel-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--secondary);
            border-bottom: 2px solid var(--secondary);
            padding-bottom: 5px;
            display: flex;
            align-items: center;
        }
        
        .player-info {
            margin-bottom: 20px;
            text-align: center;
        }
        
        .character-name {
            font-size: 1.8rem;
            color: var(--secondary);
            margin-bottom: 10px;
        }
        
        .character-status {
            font-size: 1.2rem;
            color: #bbbbbb;
            margin-bottom: 15px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .stat-card {
            background: rgba(40, 60, 90, 0.7);
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .stat-name {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .stat-value {
            font-size: 1.4rem;
            font-weight: bold;
        }
        
        .weather-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            padding: 10px;
            background: rgba(50, 50, 80, 0.6);
            border-radius: 5px;
        }
        
        .weather-icon {
            font-size: 2rem;
        }
        
        .skill-list {
            margin-top: 20px;
        }
        
        .skill {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            margin-bottom: 8px;
            background: rgba(40, 60, 90, 0.5);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .skill:hover {
            background: rgba(52, 152, 219, 0.3);
            transform: translateX(5px);
        }
        
        .game-console {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 5px;
            padding: 15px;
            height: 350px;
            overflow-y: auto;
            margin-bottom: 20px;
            font-family: monospace;
            border: 1px solid #444;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
        }
        
        .console-message {
            padding: 5px 0;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 12px 15px;
            border: none;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        
        .btn:active {
            transform: translateY(1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .btn-attack { 
            background: var(--danger);
            background: linear-gradient(to bottom, #e74c3c, #c0392b);
        }
        
        .btn-skill { 
            background: var(--warning);
            background: linear-gradient(to bottom, #f39c12, #d35400);
        }
        
        .btn-item { 
            background: var(--success);
            background: linear-gradient(to bottom, #2ecc71, #27ae60);
        }
        
        .btn-flee { 
            background: #9b59b6;
            background: linear-gradient(to bottom, #9b59b6, #8e44ad);
        }
        
        .btn-action { 
            background: var(--secondary);
            background: linear-gradient(to bottom, #3498db, #2980b9);
        }
        
        .battle-enemies {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }
        
        .enemy-card {
            background: rgba(100, 30, 30, 0.7);
            padding: 15px;
            border-radius: 10px;
            min-width: 150px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .enemy-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, transparent 40%, rgba(231, 76, 60, 0.2) 100%);
            z-index: -1;
            pointer-events: none;
        }
        
        .enemy-card:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(231, 76, 60, 0.5);
        }
        
        .enemy-card.selected {
            background: rgba(150, 50, 50, 0.9);
            box-shadow: 0 0 15px rgba(231, 76, 60, 0.8);
        }
        
        .enemy-name {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: #ff8a8a;
        }
        
        .hp-bar {
            height: 6px;
            background: #333;
            border-radius: 3px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .hp-fill {
            height: 100%;
            background: #e74c3c;
            transition: width 0.5s ease;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        
        select, input {
            padding: 10px;
            border-radius: 5px;
            border: none;
            background: rgba(255, 255, 255, 0.9);
            width: 100%;
            font-family: inherit;
        }
        
        .event-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
        }
        
        .event-description {
            font-size: 1.1rem;
            line-height: 1.6;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
        }
        
        .continue-btn {
            padding: 15px;
            background: rgba(52, 152, 219, 0.7);
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
            font-weight: bold;
        }
        
        .continue-btn:hover {
            background: rgba(52, 152, 219, 0.9);
            transform: scale(1.02);
        }
        
        .battle-damage {
            color: #ff8a8a;
            font-weight: bold;
        }
        
        .battle-heal {
            color: #7bed9f;
            font-weight: bold;
        }
        
        .battle-critical {
            color: #f1c40f;
            font-weight: bold;
            animation: flash 0.5s;
        }
        
        @keyframes flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .ending-container {
            text-align: center;
            padding: 30px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .ending-title {
            font-size: 2.5rem;
            color: var(--secondary);
            margin-bottom: 20px;
            text-shadow: 0 0 10px var(--secondary);
        }
        
        .ending-content {
            font-size: 1.2rem;
            margin-bottom: 25px;
            line-height: 1.7;
        }
        
        @media (max-width: 768px) {
            .game-area {
                flex-direction: column;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            .status-bar {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="game-header">
            <h1 class="game-title">艾瑟兰大陆冒险</h1>
            <p class="game-subtitle">元素战斗RPG</p>
        </div>
        
        <div class="status-bar">
            <div class="status-card">
                <div class="status-label">天数</div>
                <div id="day-value" class="status-value">1</div>
            </div>
            <div class="status-card">
                <div class="status-label">位置</div>
                <div id="location-value" class="status-value">起始之村</div>
            </div>
            <div class="status-card">
                <div class="status-label">等级</div>
                <div id="level-value" class="status-value">1</div>
            </div>
            <div class="status-card">
                <div class="status-label">元素</div>
                <div id="element-value" class="status-value">🔥</div>
            </div>
        </div>
        
        <div class="game-area">
            <div class="player-panel">
                <h2 class="panel-title">玩家信息</h2>
                
                <div class="player-info">
                    <div id="character-name" class="character-name">英雄</div>
                    <div id="character-status" class="character-status">Lv.1 [100/100 HP | 50/50 MP]</div>
                </div>
                
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-name">力量</div>
                        <div id="stat-strength" class="stat-value">15</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-name">敏捷</div>
                        <div id="stat-agility" class="stat-value">10</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-name">智力</div>
                        <div id="stat-intelligence" class="stat-value">8</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-name">经验</div>
                        <div id="stat-xp" class="stat-value">0/100</div>
                    </div>
                </div>
                
                <div class="weather-info">
                    <div id="weather-icon" class="weather-icon">☀️</div>
                    <div>
                        <div id="weather-type">晴天</div>
                        <div id="weather-effect">火属性增强</div>
                    </div>
                </div>
                
                <h2 class="panel-title">技能</h2>
                <div class="skill-list">
                    <div class="skill">
                        <div>🔥 火球术</div>
                        <div>10 MP</div>
                    </div>
                    <div class="skill">
                        <div>💫 治疗术</div>
                        <div>15 MP</div>
                    </div>
                    <div class="skill">
                        <div>❄️ 寒冰箭</div>
                        <div>12 MP</div>
                    </div>
                </div>
            </div>
            
            <div class="game-content">
                <h2 class="panel-title" id="content-title">游戏日志</h2>
                
                <div id="game-console" class="game-console">
                    <div class="console-message">欢迎来到艾瑟兰大陆！</div>
                    <div class="console-message">请输入你的角色名开始冒险...</div>
                </div>
                
                <div id="action-container">
                    <div id="name-input-section" style="display: block;">
                        <div class="input-group">
                            <input type="text" id="character-name-input" placeholder="输入角色名" value="冒险者">
                            <button id="start-btn" class="btn btn-action">开始冒险</button>
                        </div>
                    </div>
                    
                    <div id="battle-section" style="display: none;">
                        <div id="battle-enemies" class="battle-enemies">
                            <!-- 敌人会在这里动态生成 -->
                        </div>
                        
                        <div class="action-buttons">
                            <button class="btn btn-attack" data-action="attack">⚔️ 攻击</button>
                            <button class="btn btn-skill" data-action="skill">🔮 技能</button>
                            <button class="btn btn-item" data-action="item">🎒 物品</button>
                            <button class="btn btn-flee" data-action="flee">🏃 逃跑</button>
                        </div>
                    </div>
                    
                    <div id="skill-select-section" style="display: none;">
                        <div class="input-group">
                            <select id="skill-select">
                                <option value="fireball">🔥 火球术 (10 MP)</option>
                                <option value="heal">💫 治疗术 (15 MP)</option>
                                <option value="ice">❄️ 寒冰箭 (12 MP)</option>
                            </select>
                            <button id="use-skill-btn" class="btn btn-skill">使用技能</button>
                        </div>
                    </div>
                    
                    <div id="event-section" style="display: none;">
                        <div class="event-container">
                            <div id="event-description" class="event-description">
                                <!-- 事件描述会在这里 -->
                            </div>
                            <div class="continue-btn" id="event-continue">➡️ 继续旅程</div>
                        </div>
                    </div>
                    
                    <div id="ending-section" style="display: none;">
                        <div class="ending-container">
                            <div id="ending-title" class="ending-title">游戏结束</div>
                            <div id="ending-content" class="ending-content">
                                <!-- 结局内容会在这里 -->
                            </div>
                            <button id="restart-btn" class="btn btn-action">重新开始</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 游戏数据与状态
        const gameState = {
            player: null,
            day: 1,
            location: "起始之村",
            battleActive: false,
            enemies: [],
            weather: "sunny",
            currentEvent: null,
            gameStarted: false,
            selectedEnemyIndex: -1
        };

        // 角色类
        class Character {
            constructor(name) {
                this.name = name;
                this.hp = 100;
                this.maxHp = 100;
                this.mp = 50;
                this.maxMp = 50;
                this.strength = 15;
                this.agility = 10;
                this.intelligence = 8;
                this.elementAffinity = "fire";
                this.level = 1;
                this.experience = 0;
                this.skills = [
                    { id: "fireball", name: "火球术", cost: 10, power: 30, element: "fire", description: "发射一枚火球攻击敌人" },
                    { id: "heal", name: "治疗术", cost: 15, power: 0, element: null, description: "恢复自身生命值" },
                    { id: "ice", name: "寒冰箭", cost: 12, power: 25, element: "ice", description: "发射一支寒冰箭冻结敌人" }
                ];
            }
            
            getCharacterStatus() {
                return `Lv.${this.level} [${this.hp}/${this.maxHp} HP | ${this.mp}/${this.maxMp} MP | 元素: ${this.getElementIcon()}]`;
            }
            
            getElementIcon() {
                switch(this.elementAffinity) {
                    case "fire": return "🔥";
                    case "ice": return "❄️";
                    case "lightning": return "⚡";
                    default: return "";
                }
            }
            
            takeDamage(damage) {
                this.hp = Math.max(0, this.hp - damage);
                return this.hp > 0;
            }
            
            heal(amount) {
                this.hp = Math.min(this.maxHp, this.hp + amount);
            }
            
            restoreMp(amount) {
                this.mp = Math.min(this.maxMp, this.mp + amount);
            }
            
            addExperience(amount) {
                this.experience += amount;
                const neededExp = this.level * 100;
                if (this.experience >= neededExp) {
                    this.levelUp();
                    return true;
                }
                return false;
            }
            
            levelUp() {
                const neededExp = this.level * 100;
                while (this.experience >= neededExp) {
                    this.level++;
                    this.experience -= neededExp;
                    
                    // 属性提升
                    const hpIncrease = Math.floor(Math.random() * 8) + 8;
                    const mpIncrease = Math.floor(Math.random() * 6) + 5;
                    
                    this.maxHp += hpIncrease;
                    this.hp = this.maxHp;
                    this.maxMp += mpIncrease;
                    this.mp = this.maxMp;
                    
                    this.strength += Math.floor(Math.random() * 3) + 1;
                    this.agility += Math.floor(Math.random() * 2) + 1;
                    this.intelligence += Math.floor(Math.random() * 3) + 1;
                    
                    addToConsole(`⭐ ${this.name} 升级了！现在是等级 ${this.level}！`);
                    addToConsole(`最大生命值 +${hpIncrease} | 最大魔法值 +${mpIncrease}`);
                }
            }
        }

        // 敌人类
        class Enemy {
            constructor(type) {
                this.type = type;
                switch(type) {
                    case "goblin":
                        this.name = "哥布林";
                        this.hp = this.maxHp = 40;
                        this.atk = 8;
                        this.weakness = "ice";
                        this.rewardExp = 15;
                        break;
                    case "wolf":
                        this.name = "野狼";
                        this.hp = this.maxHp = 30;
                        this.atk = 10;
                        this.weakness = null;
                        this.rewardExp = 12;
                        break;
                    case "slime":
                        this.name = "史莱姆";
                        this.hp = this.maxHp = 60;
                        this.atk = 5;
                        this.weakness = "fire";
                        this.rewardExp = 20;
                        break;
                    case "ogre":
                        this.name = "食人魔";
                        this.hp = this.maxHp = 100;
                        this.atk = 15;
                        this.weakness = "lightning";
                        this.rewardExp = 35;
                        break;
                }
            }
            
            takeDamage(damage) {
                this.hp = Math.max(0, this.hp - damage);
                return this.hp > 0;
            }
        }

        // 天气系统
        class WeatherSystem {
            constructor() {
                this.weatherTypes = ["sunny", "rainy", "snowy", "stormy"];
                this.currentWeather = this.getRandomWeather();
            }
            
            getRandomWeather() {
                return this.weatherTypes[Math.floor(Math.random() * this.weatherTypes.length)];
            }
            
            updateWeather() {
                this.currentWeather = this.getRandomWeather();
                return this.currentWeather;
            }
            
            getWeatherIcon() {
                switch(this.currentWeather) {
                    case "sunny": return "☀️";
                    case "rainy": return "🌧️";
                    case "snowy": return "❄️";
                    case "stormy": return "⛈️";
                    default: return "🌈";
                }
            }
            
            getWeatherName() {
                switch(this.currentWeather) {
                    case "sunny": return "晴天";
                    case "rainy": return "雨天";
                    case "snowy": return "雪天";
                    case "stormy": return "雷暴";
                    default: return "异常天气";
                }
            }
            
            getWeatherEffect() {
                switch(this.currentWeather) {
                    case "sunny": return "火属性增强";
                    case "rainy": return "雷属性增强，火属性减弱";
                    case "snowy": return "冰属性增强，敏捷降低";
                    case "stormy": return "雷属性伤害翻倍";
                    default: return "没有特殊效果";
                }
            }
            
            getEffect(element) {
                switch(this.currentWeather) {
                    case "sunny": 
                        return element === "fire" ? 1.4 : 1.0;
                    case "rainy": 
                        if (element === "lightning") return 1.5;
                        if (element === "fire") return 0.7;
                        return 1.0;
                    case "snowy": 
                        return element === "ice" ? 1.6 : 1.0;
                    case "stormy": 
                        return element === "lightning" ? 2.0 : 1.0;
                    default:
                        return 1.0;
                }
            }
        }

        // 更新玩家信息显示
        function updatePlayerInfo() {
            if (!gameState.player) return;
            
            const player = gameState.player;
            document.getElementById("character-name").textContent = player.name;
            document.getElementById("character-status").textContent = player.getCharacterStatus();
            
            document.getElementById("stat-strength").textContent = player.strength;
            document.getElementById("stat-agility").textContent = player.agility;
            document.getElementById("stat-intelligence").textContent = player.intelligence;
            document.getElementById("level-value").textContent = player.level;
            document.getElementById("element-value").innerHTML = player.getElementIcon();
            document.getElementById("stat-xp").textContent = `${player.experience}/${player.level * 100}`;
        }

        // 更新世界信息显示
        function updateWorldInfo() {
            document.getElementById("day-value").textContent = gameState.day;
            document.getElementById("location-value").textContent = gameState.location;
            
            // 更新天气信息
            const weather = gameState.weatherSystem;
            document.getElementById("weather-icon").textContent = weather.getWeatherIcon();
            document.getElementById("weather-type").textContent = weather.getWeatherName();
            document.getElementById("weather-effect").textContent = weather.getWeatherEffect();
        }

        // 添加消息到控制台
        function addToConsole(message, className = "") {
            const consoleElement = document.getElementById("game-console");
            const messageElement = document.createElement("div");
            messageElement.className = `console-message ${className}`;
            messageElement.textContent = `>>> ${message}`;
            
            consoleElement.appendChild(messageElement);
            consoleElement.scrollTop = consoleElement.scrollHeight;
        }

        // 开始新的一天
        function startNewDay() {
            gameState.day++;
            
            // 更新天气
            const weather = gameState.weatherSystem.updateWeather();
            addToConsole(`新的一天开始了！今天是第 ${gameState.day} 天，天气: ${gameState.weatherSystem.getWeatherName()}`);
            addToConsole("探索中...");
            
            setTimeout(generateEvent, 1500);
            
            // 更新显示
            updateWorldInfo();
        }

        // 生成随机事件
        function generateEvent() {
            const events = [
                { type: "battle", weight: 60 },
                { type: "quest", weight: 20 },
                { type: "treasure", weight: 20 }
            ];
            
            const totalWeight = events.reduce((sum, e) => sum + e.weight, 0);
            let randomValue = Math.floor(Math.random() * totalWeight);
            
            for (const event of events) {
                if (randomValue < event.weight) {
                    triggerEvent(event.type);
                    return;
                }
                randomValue -= event.weight;
            }
        }

        // 触发事件
        function triggerEvent(eventType) {
            const contentTitle = document.getElementById("content-title");
            
            switch(eventType) {
                case "battle":
                    contentTitle.textContent = "⚔️ 战斗";
                    showBattleUI();
                    startBattle();
                    break;
                case "quest":
                    contentTitle.textContent = "📜 任务";
                    showEventUI();
                    triggerQuestEvent();
                    break;
                case "treasure":
                    contentTitle.textContent = "💎 宝藏";
                    showEventUI();
                    triggerTreasureEvent();
                    break;
            }
        }

        // 开始战斗
        function startBattle() {
            gameState.battleActive = true;
            gameState.enemies = [];
            gameState.selectedEnemyIndex = -1;
            
            const enemyTypes = ["goblin", "wolf", "slime"];
            const enemyCount = Math.floor(Math.random() * 2) + 2; // 2-3个敌人
            
            for (let i = 0; i < enemyCount; i++) {
                const type = enemyTypes[Math.floor(Math.random() * enemyTypes.length)];
                gameState.enemies.push(new Enemy(type));
            }
            
            renderEnemies();
            
            addToConsole("你遭遇了敌人：");
            gameState.enemies.forEach(enemy => {
                addToConsole(`  - ${enemy.name} [${enemy.hp}/${enemy.maxHp} HP]`);
            });
        }

        // 渲染敌人
        function renderEnemies() {
            const enemiesContainer = document.getElementById("battle-enemies");
            enemiesContainer.innerHTML = "";
            
            gameState.enemies.forEach((enemy, index) => {
                if (enemy.hp > 0) {
                    const enemyCard = document.createElement("div");
                    enemyCard.className = `enemy-card ${index === gameState.selectedEnemyIndex ? 'selected' : ''}`;
                    enemyCard.dataset.index = index;
                    
                    const nameElement = document.createElement("div");
                    nameElement.className = "enemy-name";
                    nameElement.textContent = enemy.name;
                    
                    const hpBar = document.createElement("div");
                    hpBar.className = "hp-bar";
                    
                    const hpFill = document.createElement("div");
                    hpFill.className = "hp-fill";
                    hpFill.style.width = `${(enemy.hp / enemy.maxHp) * 100}%`;
                    
                    hpBar.appendChild(hpFill);
                    
                    const hpElement = document.createElement("div");
                    hpElement.textContent = `HP: ${enemy.hp}/${enemy.maxHp}`;
                    
                    enemyCard.appendChild(nameElement);
                    enemyCard.appendChild(hpBar);
                    enemyCard.appendChild(hpElement);
                    enemiesContainer.appendChild(enemyCard);
                    
                    // 添加点击事件用于选择目标
                    enemyCard.addEventListener("click", function() {
                        document.querySelectorAll(".enemy-card").forEach(card => {
                            card.classList.remove("selected");
                        });
                        enemyCard.classList.add("selected");
                        gameState.selectedEnemyIndex = index;
                    });
                }
            });
        }

        // 玩家攻击
        function playerAttack() {
            if (gameState.selectedEnemyIndex === -1) {
                addToConsole("请先选择一个敌人目标！");
                return;
            }
            
            const enemy = gameState.enemies[gameState.selectedEnemyIndex];
            if (!enemy || enemy.hp <= 0) {
                addToConsole("无效的目标！请选择其他敌人");
                return;
            }
            
            // 计算伤害
            const damage = calculateDamage(gameState.player, enemy);
            const isAlive = enemy.takeDamage(damage);
            
            addToConsole(`${gameState.player.name} 攻击了 ${enemy.name}，造成了 ${damage} 点伤害！`, "battle-damage");
            
            if (!isAlive) {
                addToConsole(`${enemy.name} 被击败了！`);
            }
            
            renderEnemies();
            updatePlayerInfo();
            
            // 检查战斗是否结束
            setTimeout(checkBattleStatus, 1000);
        }

        // 玩家使用技能
        function playerUseSkill() {
            if (gameState.selectedEnemyIndex === -1) {
                addToConsole("请先选择一个目标！");
                return;
            }
            
            const enemy = gameState.enemies[gameState.selectedEnemyIndex];
            if (!enemy || enemy.hp <= 0) {
                addToConsole("无效的目标！请选择其他敌人");
                return;
            }
            
            const skillSelect = document.getElementById("skill-select");
            const selectedSkill = gameState.player.skills.find(s => s.id === skillSelect.value);
            
            // 检查MP
            if (gameState.player.mp < selectedSkill.cost) {
                addToConsole(`MP不足！无法使用 ${selectedSkill.name}`);
                return;
            }
            
            // 消耗MP
            gameState.player.mp -= selectedSkill.cost;
            updatePlayerInfo();
            
            if (selectedSkill.id === "heal") {
                // 治疗
                const healAmount = Math.floor(gameState.player.intelligence * 1.5 + 20);
                gameState.player.heal(healAmount);
                addToConsole(`${gameState.player.name} 使用了 治疗术，恢复了 ${healAmount} 点生命值！`, "battle-heal");
                
                // 隐藏技能选择界面
                document.getElementById("skill-select-section").style.display = "none";
                document.getElementById("battle-section").style.display = "block";
                
                // 敌人回合
                setTimeout(enemyTurn, 800);
            } else {
                // 攻击技能
                const damage = calculateDamage(gameState.player, enemy, selectedSkill);
                const isAlive = enemy.takeDamage(damage);
                
                const elementIcon = selectedSkill.element === "fire" ? "🔥" : 
                                  selectedSkill.element === "ice" ? "❄️" : "⚡";
                addToConsole(`${gameState.player.name} 使用了 ${elementIcon}${selectedSkill.name}！`);
                
                if (damage > 50) {
                    addToConsole("效果拔群！", "battle-critical");
                }
                
                setTimeout(() => {
                    addToConsole(`对 ${enemy.name} 造成了 ${damage} 点伤害！`, "battle-damage");
                    
                    if (!isAlive) {
                        addToConsole(`${enemy.name} 被击败了！`);
                    }
                    
                    renderEnemies();
                    
                    // 检查战斗状态
                    setTimeout(checkBattleStatus, 1000);
                }, 800);
            }
        }

        // 计算伤害
        function calculateDamage(attacker, target, skill = null) {
            // 基础伤害
            let baseDamage;
            if (skill) {
                baseDamage = skill.power;
                if (attacker.intelligence) {
                    baseDamage += attacker.intelligence * 0.5;
                }
            } else {
                baseDamage = attacker.strength * 2;
            }
            
            // 元素克制
            let elementBonus = 1.0;
            if (skill && skill.element && target.weakness === skill.element) {
                elementBonus = 2.0;
                addToConsole(`${target.name} 被 ${skill.element === "fire" ? "🔥" : 
                             skill.element === "ice" ? "❄️" : "⚡"}属性克制！伤害翻倍！`, "battle-critical");
            }
            
            // 天气影响
            let weatherBonus = skill ? gameState.weatherSystem.getEffect(skill.element) : 1.0;
            
            // 最终伤害
            let damage = Math.floor(baseDamage * elementBonus * weatherBonus);
            
            // 暴击判定
            const critChance = attacker.agility * 0.005;
            if (Math.random() < critChance) {
                damage = Math.floor(damage * 1.5);
                addToConsole("致命一击！", "battle-critical");
            }
            
            return Math.max(1, damage);
        }

        // 敌人回合
        function enemyTurn() {
            if (!gameState.battleActive) return;
            
            gameState.enemies.forEach(enemy => {
                if (enemy.hp > 0) {
                    // 玩家目标
                    const player = gameState.player;
                    
                    // 敌人行动
                    let damage = enemy.atk;
                    let attackType = "普通攻击";
                    
                    if (Math.random() < 0.3) { // 30%几率特殊攻击
                        damage = Math.floor(enemy.atk * 1.5);
                        attackType = "猛击";
                    }
                    
                    const isAlive = player.takeDamage(damage);
                    addToConsole(`${enemy.name} 使用${attackType}攻击了 ${player.name}，造成了 ${damage} 点伤害！`, "battle-damage");
                    updatePlayerInfo();
                    
                    if (!isAlive) {
                        gameOver();
                        return;
                    }
                }
            });
            
            setTimeout(checkBattleStatus, 1000);
        }

        // 检查战斗状态
        function checkBattleStatus() {
            // 检查所有敌人是否被击败
            const allDefeated = gameState.enemies.every(enemy => enemy.hp <= 0);
            
            if (allDefeated) {
                gameState.battleActive = false;
                // 计算总经验
                const totalExp = gameState.enemies.reduce((sum, enemy) => 
                    enemy.hp <= 0 ? sum + enemy.rewardExp : sum, 0);
                
                addToConsole(`战斗胜利！获得 ${totalExp} 经验值！`, "battle-heal");
                const leveledUp = gameState.player.addExperience(totalExp);
                updatePlayerInfo();
                
                // 隐藏战斗UI
                setTimeout(() => {
                    document.getElementById("battle-section").style.display = "none";
                    startNewDay();
                }, 2000);
            } else {
                // 检查玩家是否存活
                if (gameState.player.hp <= 0) {
                    gameOver();
                }
            }
        }

        // 任务事件
        function triggerQuestEvent() {
            const quests = [
                {
                    title: "护送商人",
                    description: "将商人安全送到邻镇"
                },
                {
                    title: "清除盗贼",
                    description: "消灭森林中的盗贼团伙"
                },
                {
                    title: "寻找草药",
                    description: "为村里的医生寻找治疗草药"
                }
            ];
            
            const quest = quests[Math.floor(Math.random() * quests.length)];
            gameState.currentEvent = quest;
            
            const eventDesc = document.getElementById("event-description");
            eventDesc.innerHTML = `
                <div><strong>任务：</strong> ${quest.title}</div>
                <div>${quest.description}</div>
                <div><strong>任务进行中...</strong></div>
            `;
        }

        // 完成任务事件
        function finishQuestEvent() {
            const outcomes = ["成功", "部分成功", "失败"];
            const outcome = outcomes[Math.floor(Math.random() * outcomes.length)];
            
            const eventDesc = document.getElementById("event-description");
            eventDesc.innerHTML = `<div><strong>任务结果：</strong>${outcome}！</div>`;
            
            // 根据结果添加奖励
            let rewardExp = 0;
            if (outcome === "成功") {
                rewardExp = Math.floor(Math.random() * 31) + 20; // 20-50
                eventDesc.innerHTML += `<div>获得 ${rewardExp} 经验值</div>`;
            } else if (outcome === "部分成功") {
                rewardExp = Math.floor(Math.random() * 16) + 10; // 10-25
                eventDesc.innerHTML += `<div>获得 ${rewardExp} 经验值</div>`;
            }
            
            gameState.player.addExperience(rewardExp);
            updatePlayerInfo();
            
            // 更新显示
            updateWorldInfo();
        }

        // 宝藏事件
        function triggerTreasureEvent() {
            const treasures = [
                {
                    name: "宝箱",
                    description: "你发现了一个古老的宝箱！",
                    reward: { experience: Math.floor(Math.random() * 21) + 30 } // 30-50
                },
                {
                    name: "草药袋",
                    description: "你采集了一些稀有草药",
                    reward: { experience: Math.floor(Math.random() * 16) + 10 } // 10-25
                },
                {
                    name: "魔法水晶",
                    description: "一块发光的魔法水晶",
                    reward: { hp: Math.floor(Math.random() * 21) + 20 } // 20-40
                }
            ];
            
            const treasure = treasures[Math.floor(Math.random() * treasures.length)];
            gameState.currentEvent = treasure;
            
            const eventDesc = document.getElementById("event-description");
            eventDesc.innerHTML = `
                <div>${treasure.description}</div>
                <div><strong>你发现了一个宝物：</strong> ${treasure.name}</div>
            `;
            
            // 应用奖励
            setTimeout(() => {
                // 应用奖励
                let rewardMessage = "";
                if (treasure.reward.experience) {
                    const leveledUp = gameState.player.addExperience(treasure.reward.experience);
                    rewardMessage = `获得 ${treasure.reward.experience} 经验值！`;
                    updatePlayerInfo();
                } else if (treasure.reward.hp) {
                    gameState.player.heal(treasure.reward.hp);
                    rewardMessage = `恢复 ${treasure.reward.hp} 点生命值！`;
                    updatePlayerInfo();
                }
                
                eventDesc.innerHTML += `<div class="battle-heal">${rewardMessage}</div>`;
            }, 1000);
        }

        // 游戏结束
        function gameOver() {
            addToConsole("你的角色在战斗中倒下...游戏结束", "battle-damage");
            
            // 显示结局
            showEnding();
        }
        
        // 显示游戏结局
        function showEnding() {
            const player = gameState.player;
            
            document.getElementById("content-title").textContent = "🎮 游戏结局";
            document.getElementById("event-section").style.display = "none";
            document.getElementById("battle-section").style.display = "none";
            document.getElementById("ending-section").style.display = "block";
            
            document.getElementById("ending-title").textContent = "游戏结束";
            
            document.getElementById("ending-content").innerHTML = `
                <div class="ending-content">
                    <p>${player.name} 在冒险中倒下了...</p>
                    <p>在艾瑟兰大陆的冒险中，你达到了等级 ${player.level}。</p>
                    <p>你经历了 ${gameState.day} 天的冒险</p>
                    <p>你的最终状态：</p>
                    <p>HP: ${player.hp}/${player.maxHp} | MP: ${player.mp}/${player.maxMp}</p>
                    <p>力量: ${player.strength} | 敏捷: ${player.agility} | 智力: ${player.intelligence}</p>
                </div>
            `;
        }

        // UI控制函数
        function showBattleUI() {
            document.getElementById("name-input-section").style.display = "none";
            document.getElementById("event-section").style.display = "none";
            document.getElementById("battle-section").style.display = "block";
            document.getElementById("skill-select-section").style.display = "none";
            document.getElementById("ending-section").style.display = "none";
        }

        function showEventUI() {
            document.getElementById("name-input-section").style.display = "none";
            document.getElementById("battle-section").style.display = "none";
            document.getElementById("skill-select-section").style.display = "none";
            document.getElementById("event-section").style.display = "block";
            document.getElementById("ending-section").style.display = "none";
        }

        // 初始化游戏
        function initGame() {
            // 创建系统和对象
            gameState.weatherSystem = new WeatherSystem();
            
            // 初始化显示
            updateWorldInfo();
            
            // 事件监听器
            document.getElementById("start-btn").addEventListener("click", function() {
                const nameInput = document.getElementById("character-name-input");
                const playerName = nameInput.value.trim() || "冒险者";
                
                gameState.player = new Character(playerName);
                gameState.gameStarted = true;
                
                updatePlayerInfo();
                updateWorldInfo();
                
                addToConsole(`${playerName} 开始了在艾瑟兰大陆的冒险！`);
                
                document.getElementById("name-input-section").style.display = "none";
                startNewDay();
            });

            // 技能选择
            document.querySelector(".btn-skill").addEventListener("click", function() {
                if (gameState.selectedEnemyIndex === -1) {
                    addToConsole("请先选择一个目标！");
                    return;
                }
                
                document.getElementById("battle-section").style.display = "none";
                document.getElementById("skill-select-section").style.display = "flex";
            });

            document.getElementById("use-skill-btn").addEventListener("click", playerUseSkill);

            // 攻击
            document.querySelector(".btn-attack").addEventListener("click", playerAttack);

            // 逃跑
            document.querySelector(".btn-flee").addEventListener("click", function() {
                const fleeChance = gameState.player.agility * 0.1;
                if (Math.random() < fleeChance) {
                    addToConsole("成功逃离了战斗！");
                    gameState.battleActive = false;
                    document.getElementById("battle-section").style.display = "none";
                    startNewDay();
                } else {
                    addToConsole("逃跑失败！");
                    setTimeout(enemyTurn, 800);
                }
            });
            
            // 重新开始按钮
            document.getElementById("restart-btn").addEventListener("click", function() {
                location.reload();
            });
            
            // 继续旅程按钮
            document.getElementById("event-continue").addEventListener("click", function() {
                if (gameState.currentEvent) {
                    // 如果是任务事件，需要结算
                    if (gameState.currentEvent.title && gameState.currentEvent.title.includes("任务")) {
                        finishQuestEvent();
                    } 
                    // 其他事件的结算逻辑...
                }
                
                // 继续旅程
                setTimeout(function() {
                    document.getElementById("event-section").style.display = "none";
                    startNewDay();
                }, 1000);
            });
        }

        // 启动游戏
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
