<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‰¾ç‘Ÿå…°å¤§é™†å†’é™©</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>âš”ï¸</text></svg>">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(to bottom, #1a1a2e, #16213e);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .game-header {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .game-header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(52, 152, 219, 0.1) 0%, transparent 70%);
            z-index: -1;
        }
        
        .game-title {
            color: var(--light);
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 0 10px var(--secondary);
            animation: glow 3s infinite alternate;
        }
        
        @keyframes glow {
            0% { text-shadow: 0 0 5px var(--secondary); }
            100% { text-shadow: 0 0 20px var(--secondary), 0 0 30px var(--accent); }
        }
        
        .game-subtitle {
            color: var(--light);
            font-size: 1.2rem;
            opacity: 0.8;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
            background: rgba(30, 40, 60, 0.7);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            position: relative;
        }
        
        .status-bar::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, transparent 0%, rgba(52, 152, 219, 0.1) 100%);
            z-index: -1;
            pointer-events: none;
        }
        
        .status-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 80px;
        }
        
        .status-label {
            font-size: 0.9rem;
            color: #bbbbbb;
            margin-bottom: 5px;
        }
        
        .status-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: white;
        }
        
        .game-area {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .player-panel {
            flex: 1;
            min-width: 300px;
            background: rgba(30, 40, 60, 0.8);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            color: var(--light);
            position: relative;
            overflow: hidden;
        }
        
        .player-panel::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 70% 20%, rgba(231, 76, 60, 0.1) 0%, transparent 30%);
            z-index: -1;
            pointer-events: none;
        }
        
        .game-content {
            flex: 3;
            min-width: 300px;
            background: rgba(20, 30, 40, 0.8);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
            color: var(--light);
        }
        
        .panel-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--secondary);
            border-bottom: 2px solid var(--secondary);
            padding-bottom: 5px;
            display: flex;
            align-items: center;
        }
        
        .player-info {
            margin-bottom: 20px;
            text-align: center;
        }
        
        .character-name {
            font-size: 1.8rem;
            color: var(--secondary);
            margin-bottom: 10px;
        }
        
        .character-status {
            font-size: 1.2rem;
            color: #bbbbbb;
            margin-bottom: 15px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .stat-card {
            background: rgba(40, 60, 90, 0.7);
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .stat-name {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .stat-value {
            font-size: 1.4rem;
            font-weight: bold;
        }
        
        .weather-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            padding: 10px;
            background: rgba(50, 50, 80, 0.6);
            border-radius: 5px;
        }
        
        .weather-icon {
            font-size: 2rem;
        }
        
        .skill-list {
            margin-top: 20px;
        }
        
        .skill {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            margin-bottom: 8px;
            background: rgba(40, 60, 90, 0.5);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .skill:hover {
            background: rgba(52, 152, 219, 0.3);
            transform: translateX(5px);
        }
        
        .game-console {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 5px;
            padding: 15px;
            height: 350px;
            overflow-y: auto;
            margin-bottom: 20px;
            font-family: monospace;
            border: 1px solid #444;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
        }
        
        .console-message {
            padding: 5px 0;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 12px 15px;
            border: none;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        
        .btn:active {
            transform: translateY(1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .btn-attack { 
            background: var(--danger);
            background: linear-gradient(to bottom, #e74c3c, #c0392b);
        }
        
        .btn-skill { 
            background: var(--warning);
            background: linear-gradient(to bottom, #f39c12, #d35400);
        }
        
        .btn-item { 
            background: var(--success);
            background: linear-gradient(to bottom, #2ecc71, #27ae60);
        }
        
        .btn-flee { 
            background: #9b59b6;
            background: linear-gradient(to bottom, #9b59b6, #8e44ad);
        }
        
        .btn-action { 
            background: var(--secondary);
            background: linear-gradient(to bottom, #3498db, #2980b9);
        }
        
        .battle-enemies {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }
        
        .enemy-card {
            background: rgba(100, 30, 30, 0.7);
            padding: 15px;
            border-radius: 10px;
            min-width: 150px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .enemy-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, transparent 40%, rgba(231, 76, 60, 0.2) 100%);
            z-index: -1;
            pointer-events: none;
        }
        
        .enemy-card:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(231, 76, 60, 0.5);
        }
        
        .enemy-card.selected {
            background: rgba(150, 50, 50, 0.9);
            box-shadow: 0 0 15px rgba(231, 76, 60, 0.8);
        }
        
        .enemy-name {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: #ff8a8a;
        }
        
        .hp-bar {
            height: 6px;
            background: #333;
            border-radius: 3px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .hp-fill {
            height: 100%;
            background: #e74c3c;
            transition: width 0.5s ease;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        
        select, input {
            padding: 10px;
            border-radius: 5px;
            border: none;
            background: rgba(255, 255, 255, 0.9);
            width: 100%;
            font-family: inherit;
        }
        
        .event-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
        }
        
        .event-description {
            font-size: 1.1rem;
            line-height: 1.6;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
        }
        
        .continue-btn {
            padding: 15px;
            background: rgba(52, 152, 219, 0.7);
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
            font-weight: bold;
        }
        
        .continue-btn:hover {
            background: rgba(52, 152, 219, 0.9);
            transform: scale(1.02);
        }
        
        .battle-damage {
            color: #ff8a8a;
            font-weight: bold;
        }
        
        .battle-heal {
            color: #7bed9f;
            font-weight: bold;
        }
        
        .battle-critical {
            color: #f1c40f;
            font-weight: bold;
            animation: flash 0.5s;
        }
        
        @keyframes flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .ending-container {
            text-align: center;
            padding: 30px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .ending-title {
            font-size: 2.5rem;
            color: var(--secondary);
            margin-bottom: 20px;
            text-shadow: 0 0 10px var(--secondary);
        }
        
        .ending-content {
            font-size: 1.2rem;
            margin-bottom: 25px;
            line-height: 1.7;
        }
        
        @media (max-width: 768px) {
            .game-area {
                flex-direction: column;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            .status-bar {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="game-header">
            <h1 class="game-title">è‰¾ç‘Ÿå…°å¤§é™†å†’é™©</h1>
            <p class="game-subtitle">å…ƒç´ æˆ˜æ–—RPG</p>
        </div>
        
        <div class="status-bar">
            <div class="status-card">
                <div class="status-label">å¤©æ•°</div>
                <div id="day-value" class="status-value">1</div>
            </div>
            <div class="status-card">
                <div class="status-label">ä½ç½®</div>
                <div id="location-value" class="status-value">èµ·å§‹ä¹‹æ‘</div>
            </div>
            <div class="status-card">
                <div class="status-label">ç­‰çº§</div>
                <div id="level-value" class="status-value">1</div>
            </div>
            <div class="status-card">
                <div class="status-label">å…ƒç´ </div>
                <div id="element-value" class="status-value">ğŸ”¥</div>
            </div>
        </div>
        
        <div class="game-area">
            <div class="player-panel">
                <h2 class="panel-title">ç©å®¶ä¿¡æ¯</h2>
                
                <div class="player-info">
                    <div id="character-name" class="character-name">è‹±é›„</div>
                    <div id="character-status" class="character-status">Lv.1 [100/100 HP | 50/50 MP]</div>
                </div>
                
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-name">åŠ›é‡</div>
                        <div id="stat-strength" class="stat-value">15</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-name">æ•æ·</div>
                        <div id="stat-agility" class="stat-value">10</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-name">æ™ºåŠ›</div>
                        <div id="stat-intelligence" class="stat-value">8</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-name">ç»éªŒ</div>
                        <div id="stat-xp" class="stat-value">0/100</div>
                    </div>
                </div>
                
                <div class="weather-info">
                    <div id="weather-icon" class="weather-icon">â˜€ï¸</div>
                    <div>
                        <div id="weather-type">æ™´å¤©</div>
                        <div id="weather-effect">ç«å±æ€§å¢å¼º</div>
                    </div>
                </div>
                
                <h2 class="panel-title">æŠ€èƒ½</h2>
                <div class="skill-list">
                    <div class="skill">
                        <div>ğŸ”¥ ç«çƒæœ¯</div>
                        <div>10 MP</div>
                    </div>
                    <div class="skill">
                        <div>ğŸ’« æ²»ç–—æœ¯</div>
                        <div>15 MP</div>
                    </div>
                    <div class="skill">
                        <div>â„ï¸ å¯’å†°ç®­</div>
                        <div>12 MP</div>
                    </div>
                </div>
            </div>
            
            <div class="game-content">
                <h2 class="panel-title" id="content-title">æ¸¸æˆæ—¥å¿—</h2>
                
                <div id="game-console" class="game-console">
                    <div class="console-message">æ¬¢è¿æ¥åˆ°è‰¾ç‘Ÿå…°å¤§é™†ï¼</div>
                    <div class="console-message">è¯·è¾“å…¥ä½ çš„è§’è‰²åå¼€å§‹å†’é™©...</div>
                </div>
                
                <div id="action-container">
                    <div id="name-input-section" style="display: block;">
                        <div class="input-group">
                            <input type="text" id="character-name-input" placeholder="è¾“å…¥è§’è‰²å" value="å†’é™©è€…">
                            <button id="start-btn" class="btn btn-action">å¼€å§‹å†’é™©</button>
                        </div>
                    </div>
                    
                    <div id="battle-section" style="display: none;">
                        <div id="battle-enemies" class="battle-enemies">
                            <!-- æ•Œäººä¼šåœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                        
                        <div class="action-buttons">
                            <button class="btn btn-attack" data-action="attack">âš”ï¸ æ”»å‡»</button>
                            <button class="btn btn-skill" data-action="skill">ğŸ”® æŠ€èƒ½</button>
                            <button class="btn btn-item" data-action="item">ğŸ’ ç‰©å“</button>
                            <button class="btn btn-flee" data-action="flee">ğŸƒ é€ƒè·‘</button>
                        </div>
                    </div>
                    
                    <div id="skill-select-section" style="display: none;">
                        <div class="input-group">
                            <select id="skill-select">
                                <option value="fireball">ğŸ”¥ ç«çƒæœ¯ (10 MP)</option>
                                <option value="heal">ğŸ’« æ²»ç–—æœ¯ (15 MP)</option>
                                <option value="ice">â„ï¸ å¯’å†°ç®­ (12 MP)</option>
                            </select>
                            <button id="use-skill-btn" class="btn btn-skill">ä½¿ç”¨æŠ€èƒ½</button>
                        </div>
                    </div>
                    
                    <div id="event-section" style="display: none;">
                        <div class="event-container">
                            <div id="event-description" class="event-description">
                                <!-- äº‹ä»¶æè¿°ä¼šåœ¨è¿™é‡Œ -->
                            </div>
                            <div class="continue-btn" id="event-continue">â¡ï¸ ç»§ç»­æ—…ç¨‹</div>
                        </div>
                    </div>
                    
                    <div id="ending-section" style="display: none;">
                        <div class="ending-container">
                            <div id="ending-title" class="ending-title">æ¸¸æˆç»“æŸ</div>
                            <div id="ending-content" class="ending-content">
                                <!-- ç»“å±€å†…å®¹ä¼šåœ¨è¿™é‡Œ -->
                            </div>
                            <button id="restart-btn" class="btn btn-action">é‡æ–°å¼€å§‹</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆæ•°æ®ä¸çŠ¶æ€
        const gameState = {
            player: null,
            day: 1,
            location: "èµ·å§‹ä¹‹æ‘",
            battleActive: false,
            enemies: [],
            weather: "sunny",
            currentEvent: null,
            gameStarted: false,
            selectedEnemyIndex: -1
        };

        // è§’è‰²ç±»
        class Character {
            constructor(name) {
                this.name = name;
                this.hp = 100;
                this.maxHp = 100;
                this.mp = 50;
                this.maxMp = 50;
                this.strength = 15;
                this.agility = 10;
                this.intelligence = 8;
                this.elementAffinity = "fire";
                this.level = 1;
                this.experience = 0;
                this.skills = [
                    { id: "fireball", name: "ç«çƒæœ¯", cost: 10, power: 30, element: "fire", description: "å‘å°„ä¸€æšç«çƒæ”»å‡»æ•Œäºº" },
                    { id: "heal", name: "æ²»ç–—æœ¯", cost: 15, power: 0, element: null, description: "æ¢å¤è‡ªèº«ç”Ÿå‘½å€¼" },
                    { id: "ice", name: "å¯’å†°ç®­", cost: 12, power: 25, element: "ice", description: "å‘å°„ä¸€æ”¯å¯’å†°ç®­å†»ç»“æ•Œäºº" }
                ];
            }
            
            getCharacterStatus() {
                return `Lv.${this.level} [${this.hp}/${this.maxHp} HP | ${this.mp}/${this.maxMp} MP | å…ƒç´ : ${this.getElementIcon()}]`;
            }
            
            getElementIcon() {
                switch(this.elementAffinity) {
                    case "fire": return "ğŸ”¥";
                    case "ice": return "â„ï¸";
                    case "lightning": return "âš¡";
                    default: return "";
                }
            }
            
            takeDamage(damage) {
                this.hp = Math.max(0, this.hp - damage);
                return this.hp > 0;
            }
            
            heal(amount) {
                this.hp = Math.min(this.maxHp, this.hp + amount);
            }
            
            restoreMp(amount) {
                this.mp = Math.min(this.maxMp, this.mp + amount);
            }
            
            addExperience(amount) {
                this.experience += amount;
                const neededExp = this.level * 100;
                if (this.experience >= neededExp) {
                    this.levelUp();
                    return true;
                }
                return false;
            }
            
            levelUp() {
                const neededExp = this.level * 100;
                while (this.experience >= neededExp) {
                    this.level++;
                    this.experience -= neededExp;
                    
                    // å±æ€§æå‡
                    const hpIncrease = Math.floor(Math.random() * 8) + 8;
                    const mpIncrease = Math.floor(Math.random() * 6) + 5;
                    
                    this.maxHp += hpIncrease;
                    this.hp = this.maxHp;
                    this.maxMp += mpIncrease;
                    this.mp = this.maxMp;
                    
                    this.strength += Math.floor(Math.random() * 3) + 1;
                    this.agility += Math.floor(Math.random() * 2) + 1;
                    this.intelligence += Math.floor(Math.random() * 3) + 1;
                    
                    addToConsole(`â­ ${this.name} å‡çº§äº†ï¼ç°åœ¨æ˜¯ç­‰çº§ ${this.level}ï¼`);
                    addToConsole(`æœ€å¤§ç”Ÿå‘½å€¼ +${hpIncrease} | æœ€å¤§é­”æ³•å€¼ +${mpIncrease}`);
                }
            }
        }

        // æ•Œäººç±»
        class Enemy {
            constructor(type) {
                this.type = type;
                switch(type) {
                    case "goblin":
                        this.name = "å“¥å¸ƒæ—";
                        this.hp = this.maxHp = 40;
                        this.atk = 8;
                        this.weakness = "ice";
                        this.rewardExp = 15;
                        break;
                    case "wolf":
                        this.name = "é‡ç‹¼";
                        this.hp = this.maxHp = 30;
                        this.atk = 10;
                        this.weakness = null;
                        this.rewardExp = 12;
                        break;
                    case "slime":
                        this.name = "å²è±å§†";
                        this.hp = this.maxHp = 60;
                        this.atk = 5;
                        this.weakness = "fire";
                        this.rewardExp = 20;
                        break;
                    case "ogre":
                        this.name = "é£Ÿäººé­”";
                        this.hp = this.maxHp = 100;
                        this.atk = 15;
                        this.weakness = "lightning";
                        this.rewardExp = 35;
                        break;
                }
            }
            
            takeDamage(damage) {
                this.hp = Math.max(0, this.hp - damage);
                return this.hp > 0;
            }
        }

        // å¤©æ°”ç³»ç»Ÿ
        class WeatherSystem {
            constructor() {
                this.weatherTypes = ["sunny", "rainy", "snowy", "stormy"];
                this.currentWeather = this.getRandomWeather();
            }
            
            getRandomWeather() {
                return this.weatherTypes[Math.floor(Math.random() * this.weatherTypes.length)];
            }
            
            updateWeather() {
                this.currentWeather = this.getRandomWeather();
                return this.currentWeather;
            }
            
            getWeatherIcon() {
                switch(this.currentWeather) {
                    case "sunny": return "â˜€ï¸";
                    case "rainy": return "ğŸŒ§ï¸";
                    case "snowy": return "â„ï¸";
                    case "stormy": return "â›ˆï¸";
                    default: return "ğŸŒˆ";
                }
            }
            
            getWeatherName() {
                switch(this.currentWeather) {
                    case "sunny": return "æ™´å¤©";
                    case "rainy": return "é›¨å¤©";
                    case "snowy": return "é›ªå¤©";
                    case "stormy": return "é›·æš´";
                    default: return "å¼‚å¸¸å¤©æ°”";
                }
            }
            
            getWeatherEffect() {
                switch(this.currentWeather) {
                    case "sunny": return "ç«å±æ€§å¢å¼º";
                    case "rainy": return "é›·å±æ€§å¢å¼ºï¼Œç«å±æ€§å‡å¼±";
                    case "snowy": return "å†°å±æ€§å¢å¼ºï¼Œæ•æ·é™ä½";
                    case "stormy": return "é›·å±æ€§ä¼¤å®³ç¿»å€";
                    default: return "æ²¡æœ‰ç‰¹æ®Šæ•ˆæœ";
                }
            }
            
            getEffect(element) {
                switch(this.currentWeather) {
                    case "sunny": 
                        return element === "fire" ? 1.4 : 1.0;
                    case "rainy": 
                        if (element === "lightning") return 1.5;
                        if (element === "fire") return 0.7;
                        return 1.0;
                    case "snowy": 
                        return element === "ice" ? 1.6 : 1.0;
                    case "stormy": 
                        return element === "lightning" ? 2.0 : 1.0;
                    default:
                        return 1.0;
                }
            }
        }

        // æ›´æ–°ç©å®¶ä¿¡æ¯æ˜¾ç¤º
        function updatePlayerInfo() {
            if (!gameState.player) return;
            
            const player = gameState.player;
            document.getElementById("character-name").textContent = player.name;
            document.getElementById("character-status").textContent = player.getCharacterStatus();
            
            document.getElementById("stat-strength").textContent = player.strength;
            document.getElementById("stat-agility").textContent = player.agility;
            document.getElementById("stat-intelligence").textContent = player.intelligence;
            document.getElementById("level-value").textContent = player.level;
            document.getElementById("element-value").innerHTML = player.getElementIcon();
            document.getElementById("stat-xp").textContent = `${player.experience}/${player.level * 100}`;
        }

        // æ›´æ–°ä¸–ç•Œä¿¡æ¯æ˜¾ç¤º
        function updateWorldInfo() {
            document.getElementById("day-value").textContent = gameState.day;
            document.getElementById("location-value").textContent = gameState.location;
            
            // æ›´æ–°å¤©æ°”ä¿¡æ¯
            const weather = gameState.weatherSystem;
            document.getElementById("weather-icon").textContent = weather.getWeatherIcon();
            document.getElementById("weather-type").textContent = weather.getWeatherName();
            document.getElementById("weather-effect").textContent = weather.getWeatherEffect();
        }

        // æ·»åŠ æ¶ˆæ¯åˆ°æ§åˆ¶å°
        function addToConsole(message, className = "") {
            const consoleElement = document.getElementById("game-console");
            const messageElement = document.createElement("div");
            messageElement.className = `console-message ${className}`;
            messageElement.textContent = `>>> ${message}`;
            
            consoleElement.appendChild(messageElement);
            consoleElement.scrollTop = consoleElement.scrollHeight;
        }

        // å¼€å§‹æ–°çš„ä¸€å¤©
        function startNewDay() {
            gameState.day++;
            
            // æ›´æ–°å¤©æ°”
            const weather = gameState.weatherSystem.updateWeather();
            addToConsole(`æ–°çš„ä¸€å¤©å¼€å§‹äº†ï¼ä»Šå¤©æ˜¯ç¬¬ ${gameState.day} å¤©ï¼Œå¤©æ°”: ${gameState.weatherSystem.getWeatherName()}`);
            addToConsole("æ¢ç´¢ä¸­...");
            
            setTimeout(generateEvent, 1500);
            
            // æ›´æ–°æ˜¾ç¤º
            updateWorldInfo();
        }

        // ç”Ÿæˆéšæœºäº‹ä»¶
        function generateEvent() {
            const events = [
                { type: "battle", weight: 60 },
                { type: "quest", weight: 20 },
                { type: "treasure", weight: 20 }
            ];
            
            const totalWeight = events.reduce((sum, e) => sum + e.weight, 0);
            let randomValue = Math.floor(Math.random() * totalWeight);
            
            for (const event of events) {
                if (randomValue < event.weight) {
                    triggerEvent(event.type);
                    return;
                }
                randomValue -= event.weight;
            }
        }

        // è§¦å‘äº‹ä»¶
        function triggerEvent(eventType) {
            const contentTitle = document.getElementById("content-title");
            
            switch(eventType) {
                case "battle":
                    contentTitle.textContent = "âš”ï¸ æˆ˜æ–—";
                    showBattleUI();
                    startBattle();
                    break;
                case "quest":
                    contentTitle.textContent = "ğŸ“œ ä»»åŠ¡";
                    showEventUI();
                    triggerQuestEvent();
                    break;
                case "treasure":
                    contentTitle.textContent = "ğŸ’ å®è—";
                    showEventUI();
                    triggerTreasureEvent();
                    break;
            }
        }

        // å¼€å§‹æˆ˜æ–—
        function startBattle() {
            gameState.battleActive = true;
            gameState.enemies = [];
            gameState.selectedEnemyIndex = -1;
            
            const enemyTypes = ["goblin", "wolf", "slime"];
            const enemyCount = Math.floor(Math.random() * 2) + 2; // 2-3ä¸ªæ•Œäºº
            
            for (let i = 0; i < enemyCount; i++) {
                const type = enemyTypes[Math.floor(Math.random() * enemyTypes.length)];
                gameState.enemies.push(new Enemy(type));
            }
            
            renderEnemies();
            
            addToConsole("ä½ é­é‡äº†æ•Œäººï¼š");
            gameState.enemies.forEach(enemy => {
                addToConsole(`  - ${enemy.name} [${enemy.hp}/${enemy.maxHp} HP]`);
            });
        }

        // æ¸²æŸ“æ•Œäºº
        function renderEnemies() {
            const enemiesContainer = document.getElementById("battle-enemies");
            enemiesContainer.innerHTML = "";
            
            gameState.enemies.forEach((enemy, index) => {
                if (enemy.hp > 0) {
                    const enemyCard = document.createElement("div");
                    enemyCard.className = `enemy-card ${index === gameState.selectedEnemyIndex ? 'selected' : ''}`;
                    enemyCard.dataset.index = index;
                    
                    const nameElement = document.createElement("div");
                    nameElement.className = "enemy-name";
                    nameElement.textContent = enemy.name;
                    
                    const hpBar = document.createElement("div");
                    hpBar.className = "hp-bar";
                    
                    const hpFill = document.createElement("div");
                    hpFill.className = "hp-fill";
                    hpFill.style.width = `${(enemy.hp / enemy.maxHp) * 100}%`;
                    
                    hpBar.appendChild(hpFill);
                    
                    const hpElement = document.createElement("div");
                    hpElement.textContent = `HP: ${enemy.hp}/${enemy.maxHp}`;
                    
                    enemyCard.appendChild(nameElement);
                    enemyCard.appendChild(hpBar);
                    enemyCard.appendChild(hpElement);
                    enemiesContainer.appendChild(enemyCard);
                    
                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç”¨äºé€‰æ‹©ç›®æ ‡
                    enemyCard.addEventListener("click", function() {
                        document.querySelectorAll(".enemy-card").forEach(card => {
                            card.classList.remove("selected");
                        });
                        enemyCard.classList.add("selected");
                        gameState.selectedEnemyIndex = index;
                    });
                }
            });
        }

        // ç©å®¶æ”»å‡»
        function playerAttack() {
            if (gameState.selectedEnemyIndex === -1) {
                addToConsole("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ•Œäººç›®æ ‡ï¼");
                return;
            }
            
            const enemy = gameState.enemies[gameState.selectedEnemyIndex];
            if (!enemy || enemy.hp <= 0) {
                addToConsole("æ— æ•ˆçš„ç›®æ ‡ï¼è¯·é€‰æ‹©å…¶ä»–æ•Œäºº");
                return;
            }
            
            // è®¡ç®—ä¼¤å®³
            const damage = calculateDamage(gameState.player, enemy);
            const isAlive = enemy.takeDamage(damage);
            
            addToConsole(`${gameState.player.name} æ”»å‡»äº† ${enemy.name}ï¼Œé€ æˆäº† ${damage} ç‚¹ä¼¤å®³ï¼`, "battle-damage");
            
            if (!isAlive) {
                addToConsole(`${enemy.name} è¢«å‡»è´¥äº†ï¼`);
            }
            
            renderEnemies();
            updatePlayerInfo();
            
            // æ£€æŸ¥æˆ˜æ–—æ˜¯å¦ç»“æŸ
            setTimeout(checkBattleStatus, 1000);
        }

        // ç©å®¶ä½¿ç”¨æŠ€èƒ½
        function playerUseSkill() {
            if (gameState.selectedEnemyIndex === -1) {
                addToConsole("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç›®æ ‡ï¼");
                return;
            }
            
            const enemy = gameState.enemies[gameState.selectedEnemyIndex];
            if (!enemy || enemy.hp <= 0) {
                addToConsole("æ— æ•ˆçš„ç›®æ ‡ï¼è¯·é€‰æ‹©å…¶ä»–æ•Œäºº");
                return;
            }
            
            const skillSelect = document.getElementById("skill-select");
            const selectedSkill = gameState.player.skills.find(s => s.id === skillSelect.value);
            
            // æ£€æŸ¥MP
            if (gameState.player.mp < selectedSkill.cost) {
                addToConsole(`MPä¸è¶³ï¼æ— æ³•ä½¿ç”¨ ${selectedSkill.name}`);
                return;
            }
            
            // æ¶ˆè€—MP
            gameState.player.mp -= selectedSkill.cost;
            updatePlayerInfo();
            
            if (selectedSkill.id === "heal") {
                // æ²»ç–—
                const healAmount = Math.floor(gameState.player.intelligence * 1.5 + 20);
                gameState.player.heal(healAmount);
                addToConsole(`${gameState.player.name} ä½¿ç”¨äº† æ²»ç–—æœ¯ï¼Œæ¢å¤äº† ${healAmount} ç‚¹ç”Ÿå‘½å€¼ï¼`, "battle-heal");
                
                // éšè—æŠ€èƒ½é€‰æ‹©ç•Œé¢
                document.getElementById("skill-select-section").style.display = "none";
                document.getElementById("battle-section").style.display = "block";
                
                // æ•Œäººå›åˆ
                setTimeout(enemyTurn, 800);
            } else {
                // æ”»å‡»æŠ€èƒ½
                const damage = calculateDamage(gameState.player, enemy, selectedSkill);
                const isAlive = enemy.takeDamage(damage);
                
                const elementIcon = selectedSkill.element === "fire" ? "ğŸ”¥" : 
                                  selectedSkill.element === "ice" ? "â„ï¸" : "âš¡";
                addToConsole(`${gameState.player.name} ä½¿ç”¨äº† ${elementIcon}${selectedSkill.name}ï¼`);
                
                if (damage > 50) {
                    addToConsole("æ•ˆæœæ‹”ç¾¤ï¼", "battle-critical");
                }
                
                setTimeout(() => {
                    addToConsole(`å¯¹ ${enemy.name} é€ æˆäº† ${damage} ç‚¹ä¼¤å®³ï¼`, "battle-damage");
                    
                    if (!isAlive) {
                        addToConsole(`${enemy.name} è¢«å‡»è´¥äº†ï¼`);
                    }
                    
                    renderEnemies();
                    
                    // æ£€æŸ¥æˆ˜æ–—çŠ¶æ€
                    setTimeout(checkBattleStatus, 1000);
                }, 800);
            }
        }

        // è®¡ç®—ä¼¤å®³
        function calculateDamage(attacker, target, skill = null) {
            // åŸºç¡€ä¼¤å®³
            let baseDamage;
            if (skill) {
                baseDamage = skill.power;
                if (attacker.intelligence) {
                    baseDamage += attacker.intelligence * 0.5;
                }
            } else {
                baseDamage = attacker.strength * 2;
            }
            
            // å…ƒç´ å…‹åˆ¶
            let elementBonus = 1.0;
            if (skill && skill.element && target.weakness === skill.element) {
                elementBonus = 2.0;
                addToConsole(`${target.name} è¢« ${skill.element === "fire" ? "ğŸ”¥" : 
                             skill.element === "ice" ? "â„ï¸" : "âš¡"}å±æ€§å…‹åˆ¶ï¼ä¼¤å®³ç¿»å€ï¼`, "battle-critical");
            }
            
            // å¤©æ°”å½±å“
            let weatherBonus = skill ? gameState.weatherSystem.getEffect(skill.element) : 1.0;
            
            // æœ€ç»ˆä¼¤å®³
            let damage = Math.floor(baseDamage * elementBonus * weatherBonus);
            
            // æš´å‡»åˆ¤å®š
            const critChance = attacker.agility * 0.005;
            if (Math.random() < critChance) {
                damage = Math.floor(damage * 1.5);
                addToConsole("è‡´å‘½ä¸€å‡»ï¼", "battle-critical");
            }
            
            return Math.max(1, damage);
        }

        // æ•Œäººå›åˆ
        function enemyTurn() {
            if (!gameState.battleActive) return;
            
            gameState.enemies.forEach(enemy => {
                if (enemy.hp > 0) {
                    // ç©å®¶ç›®æ ‡
                    const player = gameState.player;
                    
                    // æ•Œäººè¡ŒåŠ¨
                    let damage = enemy.atk;
                    let attackType = "æ™®é€šæ”»å‡»";
                    
                    if (Math.random() < 0.3) { // 30%å‡ ç‡ç‰¹æ®Šæ”»å‡»
                        damage = Math.floor(enemy.atk * 1.5);
                        attackType = "çŒ›å‡»";
                    }
                    
                    const isAlive = player.takeDamage(damage);
                    addToConsole(`${enemy.name} ä½¿ç”¨${attackType}æ”»å‡»äº† ${player.name}ï¼Œé€ æˆäº† ${damage} ç‚¹ä¼¤å®³ï¼`, "battle-damage");
                    updatePlayerInfo();
                    
                    if (!isAlive) {
                        gameOver();
                        return;
                    }
                }
            });
            
            setTimeout(checkBattleStatus, 1000);
        }

        // æ£€æŸ¥æˆ˜æ–—çŠ¶æ€
        function checkBattleStatus() {
            // æ£€æŸ¥æ‰€æœ‰æ•Œäººæ˜¯å¦è¢«å‡»è´¥
            const allDefeated = gameState.enemies.every(enemy => enemy.hp <= 0);
            
            if (allDefeated) {
                gameState.battleActive = false;
                // è®¡ç®—æ€»ç»éªŒ
                const totalExp = gameState.enemies.reduce((sum, enemy) => 
                    enemy.hp <= 0 ? sum + enemy.rewardExp : sum, 0);
                
                addToConsole(`æˆ˜æ–—èƒœåˆ©ï¼è·å¾— ${totalExp} ç»éªŒå€¼ï¼`, "battle-heal");
                const leveledUp = gameState.player.addExperience(totalExp);
                updatePlayerInfo();
                
                // éšè—æˆ˜æ–—UI
                setTimeout(() => {
                    document.getElementById("battle-section").style.display = "none";
                    startNewDay();
                }, 2000);
            } else {
                // æ£€æŸ¥ç©å®¶æ˜¯å¦å­˜æ´»
                if (gameState.player.hp <= 0) {
                    gameOver();
                }
            }
        }

        // ä»»åŠ¡äº‹ä»¶
        function triggerQuestEvent() {
            const quests = [
                {
                    title: "æŠ¤é€å•†äºº",
                    description: "å°†å•†äººå®‰å…¨é€åˆ°é‚»é•‡"
                },
                {
                    title: "æ¸…é™¤ç›—è´¼",
                    description: "æ¶ˆç­æ£®æ—ä¸­çš„ç›—è´¼å›¢ä¼™"
                },
                {
                    title: "å¯»æ‰¾è‰è¯",
                    description: "ä¸ºæ‘é‡Œçš„åŒ»ç”Ÿå¯»æ‰¾æ²»ç–—è‰è¯"
                }
            ];
            
            const quest = quests[Math.floor(Math.random() * quests.length)];
            gameState.currentEvent = quest;
            
            const eventDesc = document.getElementById("event-description");
            eventDesc.innerHTML = `
                <div><strong>ä»»åŠ¡ï¼š</strong> ${quest.title}</div>
                <div>${quest.description}</div>
                <div><strong>ä»»åŠ¡è¿›è¡Œä¸­...</strong></div>
            `;
        }

        // å®Œæˆä»»åŠ¡äº‹ä»¶
        function finishQuestEvent() {
            const outcomes = ["æˆåŠŸ", "éƒ¨åˆ†æˆåŠŸ", "å¤±è´¥"];
            const outcome = outcomes[Math.floor(Math.random() * outcomes.length)];
            
            const eventDesc = document.getElementById("event-description");
            eventDesc.innerHTML = `<div><strong>ä»»åŠ¡ç»“æœï¼š</strong>${outcome}ï¼</div>`;
            
            // æ ¹æ®ç»“æœæ·»åŠ å¥–åŠ±
            let rewardExp = 0;
            if (outcome === "æˆåŠŸ") {
                rewardExp = Math.floor(Math.random() * 31) + 20; // 20-50
                eventDesc.innerHTML += `<div>è·å¾— ${rewardExp} ç»éªŒå€¼</div>`;
            } else if (outcome === "éƒ¨åˆ†æˆåŠŸ") {
                rewardExp = Math.floor(Math.random() * 16) + 10; // 10-25
                eventDesc.innerHTML += `<div>è·å¾— ${rewardExp} ç»éªŒå€¼</div>`;
            }
            
            gameState.player.addExperience(rewardExp);
            updatePlayerInfo();
            
            // æ›´æ–°æ˜¾ç¤º
            updateWorldInfo();
        }

        // å®è—äº‹ä»¶
        function triggerTreasureEvent() {
            const treasures = [
                {
                    name: "å®ç®±",
                    description: "ä½ å‘ç°äº†ä¸€ä¸ªå¤è€çš„å®ç®±ï¼",
                    reward: { experience: Math.floor(Math.random() * 21) + 30 } // 30-50
                },
                {
                    name: "è‰è¯è¢‹",
                    description: "ä½ é‡‡é›†äº†ä¸€äº›ç¨€æœ‰è‰è¯",
                    reward: { experience: Math.floor(Math.random() * 16) + 10 } // 10-25
                },
                {
                    name: "é­”æ³•æ°´æ™¶",
                    description: "ä¸€å—å‘å…‰çš„é­”æ³•æ°´æ™¶",
                    reward: { hp: Math.floor(Math.random() * 21) + 20 } // 20-40
                }
            ];
            
            const treasure = treasures[Math.floor(Math.random() * treasures.length)];
            gameState.currentEvent = treasure;
            
            const eventDesc = document.getElementById("event-description");
            eventDesc.innerHTML = `
                <div>${treasure.description}</div>
                <div><strong>ä½ å‘ç°äº†ä¸€ä¸ªå®ç‰©ï¼š</strong> ${treasure.name}</div>
            `;
            
            // åº”ç”¨å¥–åŠ±
            setTimeout(() => {
                // åº”ç”¨å¥–åŠ±
                let rewardMessage = "";
                if (treasure.reward.experience) {
                    const leveledUp = gameState.player.addExperience(treasure.reward.experience);
                    rewardMessage = `è·å¾— ${treasure.reward.experience} ç»éªŒå€¼ï¼`;
                    updatePlayerInfo();
                } else if (treasure.reward.hp) {
                    gameState.player.heal(treasure.reward.hp);
                    rewardMessage = `æ¢å¤ ${treasure.reward.hp} ç‚¹ç”Ÿå‘½å€¼ï¼`;
                    updatePlayerInfo();
                }
                
                eventDesc.innerHTML += `<div class="battle-heal">${rewardMessage}</div>`;
            }, 1000);
        }

        // æ¸¸æˆç»“æŸ
        function gameOver() {
            addToConsole("ä½ çš„è§’è‰²åœ¨æˆ˜æ–—ä¸­å€’ä¸‹...æ¸¸æˆç»“æŸ", "battle-damage");
            
            // æ˜¾ç¤ºç»“å±€
            showEnding();
        }
        
        // æ˜¾ç¤ºæ¸¸æˆç»“å±€
        function showEnding() {
            const player = gameState.player;
            
            document.getElementById("content-title").textContent = "ğŸ® æ¸¸æˆç»“å±€";
            document.getElementById("event-section").style.display = "none";
            document.getElementById("battle-section").style.display = "none";
            document.getElementById("ending-section").style.display = "block";
            
            document.getElementById("ending-title").textContent = "æ¸¸æˆç»“æŸ";
            
            document.getElementById("ending-content").innerHTML = `
                <div class="ending-content">
                    <p>${player.name} åœ¨å†’é™©ä¸­å€’ä¸‹äº†...</p>
                    <p>åœ¨è‰¾ç‘Ÿå…°å¤§é™†çš„å†’é™©ä¸­ï¼Œä½ è¾¾åˆ°äº†ç­‰çº§ ${player.level}ã€‚</p>
                    <p>ä½ ç»å†äº† ${gameState.day} å¤©çš„å†’é™©</p>
                    <p>ä½ çš„æœ€ç»ˆçŠ¶æ€ï¼š</p>
                    <p>HP: ${player.hp}/${player.maxHp} | MP: ${player.mp}/${player.maxMp}</p>
                    <p>åŠ›é‡: ${player.strength} | æ•æ·: ${player.agility} | æ™ºåŠ›: ${player.intelligence}</p>
                </div>
            `;
        }

        // UIæ§åˆ¶å‡½æ•°
        function showBattleUI() {
            document.getElementById("name-input-section").style.display = "none";
            document.getElementById("event-section").style.display = "none";
            document.getElementById("battle-section").style.display = "block";
            document.getElementById("skill-select-section").style.display = "none";
            document.getElementById("ending-section").style.display = "none";
        }

        function showEventUI() {
            document.getElementById("name-input-section").style.display = "none";
            document.getElementById("battle-section").style.display = "none";
            document.getElementById("skill-select-section").style.display = "none";
            document.getElementById("event-section").style.display = "block";
            document.getElementById("ending-section").style.display = "none";
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // åˆ›å»ºç³»ç»Ÿå’Œå¯¹è±¡
            gameState.weatherSystem = new WeatherSystem();
            
            // åˆå§‹åŒ–æ˜¾ç¤º
            updateWorldInfo();
            
            // äº‹ä»¶ç›‘å¬å™¨
            document.getElementById("start-btn").addEventListener("click", function() {
                const nameInput = document.getElementById("character-name-input");
                const playerName = nameInput.value.trim() || "å†’é™©è€…";
                
                gameState.player = new Character(playerName);
                gameState.gameStarted = true;
                
                updatePlayerInfo();
                updateWorldInfo();
                
                addToConsole(`${playerName} å¼€å§‹äº†åœ¨è‰¾ç‘Ÿå…°å¤§é™†çš„å†’é™©ï¼`);
                
                document.getElementById("name-input-section").style.display = "none";
                startNewDay();
            });

            // æŠ€èƒ½é€‰æ‹©
            document.querySelector(".btn-skill").addEventListener("click", function() {
                if (gameState.selectedEnemyIndex === -1) {
                    addToConsole("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç›®æ ‡ï¼");
                    return;
                }
                
                document.getElementById("battle-section").style.display = "none";
                document.getElementById("skill-select-section").style.display = "flex";
            });

            document.getElementById("use-skill-btn").addEventListener("click", playerUseSkill);

            // æ”»å‡»
            document.querySelector(".btn-attack").addEventListener("click", playerAttack);

            // é€ƒè·‘
            document.querySelector(".btn-flee").addEventListener("click", function() {
                const fleeChance = gameState.player.agility * 0.1;
                if (Math.random() < fleeChance) {
                    addToConsole("æˆåŠŸé€ƒç¦»äº†æˆ˜æ–—ï¼");
                    gameState.battleActive = false;
                    document.getElementById("battle-section").style.display = "none";
                    startNewDay();
                } else {
                    addToConsole("é€ƒè·‘å¤±è´¥ï¼");
                    setTimeout(enemyTurn, 800);
                }
            });
            
            // é‡æ–°å¼€å§‹æŒ‰é’®
            document.getElementById("restart-btn").addEventListener("click", function() {
                location.reload();
            });
            
            // ç»§ç»­æ—…ç¨‹æŒ‰é’®
            document.getElementById("event-continue").addEventListener("click", function() {
                if (gameState.currentEvent) {
                    // å¦‚æœæ˜¯ä»»åŠ¡äº‹ä»¶ï¼Œéœ€è¦ç»“ç®—
                    if (gameState.currentEvent.title && gameState.currentEvent.title.includes("ä»»åŠ¡")) {
                        finishQuestEvent();
                    } 
                    // å…¶ä»–äº‹ä»¶çš„ç»“ç®—é€»è¾‘...
                }
                
                // ç»§ç»­æ—…ç¨‹
                setTimeout(function() {
                    document.getElementById("event-section").style.display = "none";
                    startNewDay();
                }, 1000);
            });
        }

        // å¯åŠ¨æ¸¸æˆ
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
